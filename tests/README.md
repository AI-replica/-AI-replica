TODO: move unit tests closer to the tested code
